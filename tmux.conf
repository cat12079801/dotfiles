# http://matsu.teraren.com/blog/2013/02/10/moteru-tmux-powerline/
# キーストロークのディレイを減らす
set -sg escape-time 0

# ウィンドウのインデックスを1から始める
set -g base-index 1

# ペインのインデックスを1から始める
setw -g pane-base-index 1

# 設定ファイルをリロードする
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# C-b*2でtmux内のプログラムにC-bを送る
bind C-b send-prefix

# \ でペインを縦に分割する
bind \ split-window -h -c "#{pane_current_path}"

# - でペインを横に分割する
bind - split-window -v -c "#{pane_current_path}"

bind c new-window -c "#{pane_current_path}"

# Vimのキーバインドでペインを移動する
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# Vimのキーバインドでペインをリサイズする
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# 256色端末を使用する
set -g default-terminal "screen-256color"

# ステータスバーの色を設定する
set -g status-fg green
set -g status-bg black
# アクティブなペインを目立たせる
set -g pane-active-border-fg black
set -g pane-active-border-bg green

# ウィンドウリストの色を設定する
setw -g window-status-fg green
setw -g window-status-bg default
setw -g window-status-attr dim
# アクティブなウィンドウを目立たせる
setw -g window-status-current-fg green
setw -g window-status-current-bg black
setw -g window-status-current-attr dim
setw -g window-status-current-attr bright

# ペインボーダーの色を設定する
set -g pane-border-fg green
set -g pane-border-bg black

# ステータスバーを下部に表示する
set -g status-position bottom

# コピーモードを設定する
# viのキーバインドを使用する
setw -g mode-keys vi

# See: https://github.com/tmux/tmux/blob/master/CHANGES
run-shell "tmux setenv -g TMUX_VERSION $(tmux -V | cut -c 6-)"

# bind-key syntax changed in 2.4
# if-shell を改行すると特定の環境で読み込まれないので一行で書く
if-shell -b '[ "$(echo "$TMUX_VERSION < 2.4" | bc)" = 1 ]' "bind-key -t vi-copy v begin-selection; bind-key -t vi-copy y copy-pipe 'reattach-to-user-namespace pbcopy'; unbind -t vi-copy Enter; bind-key -t vi-copy Enter copy-pipe 'reattach-to-user-namespace pbcopy'"
#bind-key -t vi-copy v begin-selection
#bind-key -t vi-copy y copy-pipe 'reattach-to-user-namespace pbcopy'
#unbind   -t vi-copy Enter
#bind-key -t vi-copy Enter copy-pipe 'reattach-to-user-namespace pbcopy'

if-shell -b '[ "$(echo "$TMUX_VERSION >= 2.4" | bc)" = 1 ]' "bind-key -T copy-mode-vi v send-keys -X begin-selection; bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'reattach-to-user-namespace pbcopy'"
#bind-key -T copy-mode-vi v send-keys -X begin-selection
#bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'reattach-to-user-namespace pbcopy'

set-option -g status on
set-option -g status-interval 1
set-option -g status-justify left
set-option -g status-left-length 60
set-option -g status-right-length 180

set-option -g status-left  "\
#[bg=colour148]#[fg=colour234] #S:#I.#P \
#[bg=colour054]#[fg=colour255] #h \
#[bg=colour024] #(~/dotfiles/tmux/ip.sh)\
#[fg=colour024]#[bg=colour235]"

set-option -g status-right "\
#[fg=colour236]#[fg=colour253]#[bg=colour235]\
CPU:#{cpu_percentage} \
#[fg=colour238]#[fg=colour254]#[bg=colour238]\
Mem: #{mem_percentage}%%#[fg=colour254] \
#[fg=colour240]#[fg=colour255]#[bg=colour240]\
%Y/%m/%d(%a) %H:%M "

# panes
set -g pane-border-bg colour0
set -g pane-border-fg colour238
set -g pane-active-border-bg colour0
set -g pane-active-border-fg colour119

set -g status-position bottom
set -g status-justify left
set -g status-bg colour234

setw -g window-status-current-bg colour239
setw -g window-status-current-attr bold
setw -g window-status-current-format '\
#[fg=colour239]#[bg=colour234]#[bg=colour239]#[fg=colour119]\
#I#[fg=colour249]:#[fg=colour255]#W#[fg=colour249]\
#F#[fg=colour239]#[bg=colour234]'

setw -g window-status-fg colour244
setw -g window-status-bg colour234
setw -g window-status-attr none
setw -g window-status-format ' #I#[fg=colour237]:#[fg=colour250]#W#[fg=colour244]#F '

# tpm plugins (install: C-b I)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-cpu'
#set -g @plugin 'GROG/tmux-plugin-mem' # origin
set -g @plugin 'cat12079801/tmux-plugin-mem' # forked
set -g @mem_pre_color  "#[fg=colour254]"
set -g @mem_post_color "#[fg=colour254]"
set -g @mem_high_color "#[fg=colour196]"
set -g @mem_mid_color  "#[fg=colour220]"
set -g @mem_low_color  "#[fg=colour254]"
run '~/.tmux/plugins/tpm/tpm'
